<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Edukasi Tunarungu - Lindungi Pohon</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
      
      :root {
        --primary-color: #4CAF50;
        --primary-light: #81C784;
        --primary-dark: #388E3C;
        --accent-color: #FF9800;
        --accent-light: #FFCC80;
        --accent-dark: #F57C00;
        --text-dark: #2E3D32;
        --text-light: #FFFFFF;
        --background-light: #F1F8E9;
        --background-dark: #324721;
        --soil-color: #8D6E63;
        --soil-dark: #6D4C41;
        --soil-light: #A1887F;
        --soil-dry: #D7CCC8;
      }
      
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        margin: 0;
        font-family: 'Nunito', sans-serif;
        min-height: 100vh;
        background: url("../assets/Background/TunarunguBG.jpg") no-repeat center center fixed;
        background-size: cover;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 0;
        position: relative;
        overflow: hidden;
        transition: background 1.5s ease;
      }

      /* Sky elements and animations */
      .sky-objects {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 1;
        pointer-events: none;
        overflow: hidden;
      }
      
      .sun {
        position: absolute;
        top: 40px;
        left: 40px;
        width: 100px;
        height: 100px;
        background: radial-gradient(circle, #FFEB3B 30%, #FFC107 70%);
        border-radius: 50%;
        box-shadow: 0 0 60px #FFD700;
        animation: sun-rays 3s infinite alternate;
        transition: all 1.5s ease;
      }
      
      @keyframes sun-rays {
        0% {
          box-shadow: 0 0 40px #FFD700;
        }
        100% {
          box-shadow: 0 0 80px #FFD700;
        }
      }
      
      .moon {
        position: absolute;
        top: 40px;
        right: 40px;
        width: 80px;
        height: 80px;
        background: radial-gradient(circle, #F5F5F5 60%, #E0E0E0 100%);
        border-radius: 50%;
        box-shadow: 0 0 30px #F5F5F5;
        opacity: 0;
        transition: all 1.5s ease;
        position: relative;
      }
      
      .moon:before {
        content: "";
        position: absolute;
        top: 15px;
        left: 15px;
        width: 15px;
        height: 15px;
        background: rgba(220, 220, 220, 0.4);
        border-radius: 50%;
      }
      
      .stars {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 1.5s ease;
      }
      
      .star {
        position: absolute;
        background: white;
        border-radius: 50%;
        filter: drop-shadow(0 0 6px rgba(255, 255, 255, 0.8));
        animation: twinkle 1.5s infinite alternate;
      }
      
      @keyframes twinkle {
        0% {
          opacity: 0.3;
          transform: scale(0.8);
        }
        100% {
          opacity: 1;
          transform: scale(1.2);
        }
      }

      /* Cloud styling and animation */
      .cloud {
        position: absolute;
        background: white;
        border-radius: 50px;
        filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.1));
        animation: float-cloud 60s linear infinite;
        opacity: 0.9;
      }
      
      .cloud-1 {
        top: 60px;
        left: -150px;
        width: 150px;
        height: 70px;
        transform: scale(0.9);
      }
      
      .cloud-2 {
        top: 140px;
        left: -220px;
        width: 200px;
        height: 90px;
        transform: scale(1.2);
        animation-delay: -20s;
        animation-duration: 75s;
      }
      
      .cloud-3 {
        top: 90px;
        left: -180px;
        width: 170px;
        height: 80px;
        transform: scale(1);
        animation-delay: -40s;
        animation-duration: 65s;
      }
      
      .cloud:before,
      .cloud:after {
        content: "";
        position: absolute;
        top: -30px;
        background: white;
        border-radius: 50%;
      }
      
      .cloud:before {
        width: 60px;
        height: 60px;
        left: 25px;
      }
      
      .cloud:after {
        width: 80px;
        height: 80px;
        right: 25px;
      }
      
      @keyframes float-cloud {
        0% {
          left: -200px;
        }
        100% {
          left: calc(100% + 200px);
        }
      }

      /* Game overlay elements */
      .game-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 1;
        transition: opacity 0.5s ease;
        pointer-events: none;
      }
      
      .game-overlay.hidden {
        opacity: 0;
        pointer-events: none;
      }

      /* Welcome Modal Styling */
      .welcome-modal {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.98);
        border-radius: 24px;
        box-shadow: 0 10px 50px rgba(0, 0, 0, 0.2);
        padding: 40px 32px 32px 32px;
        z-index: 1001;
        text-align: center;
        min-width: 340px;
        max-width: 90vw;
        animation: popin 0.7s cubic-bezier(0.23, 1.12, 0.62, 1.01);
      }
      
      @keyframes popin {
        0% {
          transform: translate(-50%, -60%) scale(0.7);
          opacity: 0;
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
      }
      
      .welcome-modal h1 {
        font-size: 2.2rem;
        color: var(--primary-dark);
        margin-bottom: 15px;
        letter-spacing: 1px;
        font-weight: 800;
      }
      
      .welcome-modal .emoji {
        font-size: 3rem;
        margin-bottom: 12px;
        display: block;
        animation: bounce 1.2s infinite alternate;
      }
      
      @keyframes bounce {
        0% {
          transform: translateY(0);
        }
        100% {
          transform: translateY(-12px);
        }
      }
      
      .welcome-modal p {
        font-size: 1.2rem;
        color: var(--text-dark);
        margin-bottom: 25px;
        line-height: 1.6;
      }
      
      .welcome-modal button {
        padding: 12px 36px;
        font-size: 1.15rem;
        border-radius: 15px;
        border: none;
        background: linear-gradient(90deg, #43A047 0%, #66BB6A 100%);
        color: white;
        font-weight: 700;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(56, 142, 60, 0.3);
        transition: all 0.2s;
        letter-spacing: 1px;
        font-family: 'Nunito', sans-serif;
      }
      
      .welcome-modal button:hover {
        background: linear-gradient(90deg, #388E3C 0%, #43A047 100%);
        transform: translateY(-2px) scale(1.03);
        box-shadow: 0 6px 18px rgba(56, 142, 60, 0.4);
      }
      
      .welcome-modal button:active {
        transform: translateY(1px);
      }
      
      .modal-buttons {
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: center;
      }
      
      /* How to Play Modal */
      .howto-modal {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 20px;
        box-shadow: 0 8px 40px rgba(0, 0, 0, 0.18);
        padding: 32px 28px 24px 28px;
        z-index: 1002;
        text-align: left;
        min-width: 340px;
        max-width: 92vw;
        display: none;
        animation: popin 0.6s;
      }
      
      .howto-modal h2 {
        margin-top: 0;
        color: var(--primary-dark);
        font-size: 1.5rem;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .howto-modal h2 span {
        font-size: 1.8rem;
      }
      
      .steps-container {
        margin-bottom: 15px;
      }
      
      .howto-step {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 15px;
        background: var(--background-light);
        padding: 12px 15px;
        border-radius: 12px;
      }
      
      .step-number {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
        background: var(--primary-color);
        color: white;
        border-radius: 50%;
        font-weight: bold;
      }
      
      .step-text {
        flex: 1;
        font-size: 1.1rem;
      }
      
      .howto-tips {
        background: #E8F5E9;
        border-left: 4px solid var(--primary-color);
        padding: 12px 15px;
        margin-top: 15px;
        border-radius: 0 8px 8px 0;
        font-size: 1rem;
        color: var(--primary-dark);
      }
      
      .howto-modal button {
        margin-top: 20px;
        background: var(--primary-color);
        color: white;
        font-weight: 700;
        font-size: 1.1rem;
        padding: 10px 30px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        transition: all 0.3s;
        outline: none;
        display: inline-block;
        font-family: 'Nunito', sans-serif;
      }
      
      .howto-modal button:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(76, 175, 80, 0.4);
      }
      
      .howto-modal button:active {
        transform: translateY(1px);
      }

      /* Game Area */
      .game-area {
        position: relative;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
      }

      /* Scoreboard */
      .scoreboard {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        padding: 15px 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        z-index: 10;
        min-width: 200px;
        transition: transform 0.3s;
      }
      
      .scoreboard:hover {
        transform: translateY(2px);
      }
      
      .scoreboard h1 {
        font-size: 18px;
        color: var(--primary-dark);
        margin: 0 0 10px 0;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .game-stats {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      
      .game-stat {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .stat-icon {
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
      }
      
      .stat-value {
        font-weight: bold;
        color: var(--text-dark);
      }
      
      /* Health Bar */
      .health-bar-container {
        width: 100%;
        height: 12px;
        background: #e0e0e0;
        border-radius: 6px;
        overflow: hidden;
        margin-top: 5px;
      }
      
      .health-bar {
        height: 100%;
        background: linear-gradient(90deg, #66BB6A, #4CAF50);
        border-radius: 6px;
        transition: width 0.3s;
      }
      
      .health-bar.warning {
        background: linear-gradient(90deg, #FFC107, #FF9800);
      }
      
      .health-bar.danger {
        background: linear-gradient(90deg, #FF5252, #F44336);
      }

      /* Garden and Ground */
      .garden-container {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        height: 35%;
        overflow: hidden;
        z-index: 2;
        display: flex;
        justify-content: center;
        align-items: flex-end;
      }
      
      .ground-base {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        height: 60%;
        background: var(--soil-dark);
        z-index: 2;
      }
      
      .soil-surface {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 60%;
        height: 40px;
        background: var(--soil-light);
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        z-index: 3;
      }
      
      .soil-decoration {
        position: absolute;
        bottom: 60%;
        height: 12px;
        background: var(--soil-color);
        width: 40px;
        border-radius: 50%;
        z-index: 3;
      }
      
      .ground {
        position: absolute;
        left: 50%;
        bottom: 120px;
        transform: translate(-50%, 0);
        width: 320px;
        height: 80px;
        background: var(--soil-color);
        border-radius: 50% 50% 0 0;
        box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        z-index: 4;
        transition: all 0.3s;
      }
      
      .ground::before {
        content: "";
        position: absolute;
        top: -25px;
        left: 50%;
        transform: translateX(-50%);
        width: 60%;
        height: 40px;
        background: rgba(0, 0, 0, 0.03);
        border-radius: 50%;
        z-index: -1;
      }
      
      .ground:hover {
        transform: translate(-50%, -3px);
        box-shadow: 0 -8px 20px rgba(0, 0, 0, 0.2);
      }
      
      .ground.clicked {
        background: var(--soil-dark);
        cursor: default;
      }
      
      .ground.dry {
        background: var(--soil-dry);
      }
      
      .ground.watered {
        background: var(--soil-dark);
        animation: soil-moisture 0.5s ease;
      }
      
      @keyframes soil-moisture {
        0% {
          background: var(--soil-dry);
        }
        100% {
          background: var(--soil-dark);
        }
      }
      
      .planting-hole {
        position: absolute;
        left: 50%;
        bottom: 0;
        transform: translate(-50%, 0);
        width: 50px;
        height: 25px;
        background: #3E2723;
        border-radius: 50% 50% 0 0;
        z-index: 5;
        opacity: 0;
        transition: opacity 0.3s, transform 0.3s;
      }
      
      .planting-hole.visible {
        opacity: 1;
        animation: dig-hole 0.6s ease;
      }
      
      @keyframes dig-hole {
        0% {
          transform: translate(-50%, 20px);
          opacity: 0;
        }
        100% {
          transform: translate(-50%, 0);
          opacity: 1;
        }
      }

      /* Tree Container and Stages */
      .tree-container {
        position: absolute;
        left: 50%;
        bottom: 100px;
        transform: translate(-50%, 0);
        width: 200px;
        height: 300px;
        z-index: 10;
        pointer-events: all;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        overflow: visible;
      }
      
      .tree-stage {
        position: absolute;
        left: 50%;
        bottom: 0;
        transform: translate(-50%, 0);
        opacity: 0;
        transition: opacity 0.5s, transform 0.5s;
        pointer-events: none;
        transform-origin: bottom center;
        z-index: 10;
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.1));
      }
      
      .tree-stage.active {
        opacity: 1;
        pointer-events: all;
        animation: tree-appear 0.8s ease;
      }
      
      @keyframes tree-appear {
        0% {
          transform: translate(-50%, 20px) scale(0.8);
          opacity: 0;
        }
        100% {
          transform: translate(-50%, 0) scale(1);
          opacity: 1;
        }
      }
      
      /* Growing animation */
      .tree-stage.growing {
        animation: tree-growing 2s ease-in-out infinite alternate;
      }
      
      @keyframes tree-growing {
        0% {
          transform: translate(-50%, 0) scale(1);
        }
        100% {
          transform: translate(-50%, 0) scale(1.05);
        }
      }

      /* Tools */
      .tool-container {
        position: absolute;
        bottom: 30px;
        right: 30px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
        z-index: 15;
      }
      
      .tool {
        width: 70px;
        height: 70px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        transition: all 0.3s;
        position: relative;
      }
      
      .tool:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      }
      
      .tool img {
        width: 60%;
        height: 60%;
        object-fit: contain;
        transition: transform 0.2s;
      }
      
      .tool:hover img {
        transform: scale(1.1);
      }
      
      .tool.active {
        background: #E3F2FD;
        border: 3px solid #2196F3;
        animation: tool-pulse 1.5s infinite alternate;
      }
      
      @keyframes tool-pulse {
        0% {
          box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }
        100% {
          box-shadow: 0 5px 20px rgba(33, 150, 243, 0.6);
        }
      }
      
      .tool-label {
        position: absolute;
        top: -30px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255, 255, 255, 0.9);
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: bold;
        white-space: nowrap;
        opacity: 0;
        transition: opacity 0.3s, transform 0.3s;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      
      .tool:hover .tool-label {
        opacity: 1;
        transform: translateX(-50%) translateY(-5px);
      }

      /* Water Animation */
      .water-drop {
        position: absolute;
        width: 20px;
        height: 30px;
        background: #64B5F6;
        border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
        z-index: 20;
        opacity: 0.8;
        animation: fall 1s linear forwards;
      }
      
      @keyframes fall {
        0% {
          transform: translateY(0);
          opacity: 0.8;
        }
        90% {
          opacity: 0.8;
        }
        100% {
          transform: translateY(200px);
          opacity: 0;
        }
      }
      
      .water-splash {
        position: absolute;
        width: 40px;
        height: 10px;
        background: rgba(100, 181, 246, 0.6);
        border-radius: 50%;
        z-index: 6;
        animation: splash 0.6s linear forwards;
      }
      
      @keyframes splash {
        0% {
          transform: scale(0.5);
          opacity: 0.8;
        }
        50% {
          transform: scale(1.5);
          opacity: 0.6;
        }
        100% {
          transform: scale(2);
          opacity: 0;
        }
      }

      /* Progress Bar */
      .progress-container {
        position: absolute;
        left: 50%;
        bottom: 35%;
        transform: translate(-50%, 0);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        z-index: 10;
        background: rgba(255, 255, 255, 0.8);
        padding: 10px 20px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        display: none;
        animation: fade-in 0.5s ease;
      }
      
      @keyframes fade-in {
        0% {
          opacity: 0;
          transform: translate(-50%, 20px);
        }
        100% {
          opacity: 1;
          transform: translate(-50%, 0);
        }
      }
      
      .progress-label {
        font-size: 16px;
        color: var(--text-dark);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .progress-icon {
        font-size: 20px;
      }
      
      .progress-bar-bg {
        width: 240px;
        height: 18px;
        background: #EEEEEE;
        border-radius: 10px;
        overflow: hidden;
        border: 2px solid #BDBDBD;
      }
      
      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #81C784, #388E3C);
        width: 0%;
        transition: width 0.3s;
        position: relative;
        overflow: hidden;
      }
      
      .progress-bar::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          90deg, 
          rgba(255, 255, 255, 0) 0%, 
          rgba(255, 255, 255, 0.3) 50%, 
          rgba(255, 255, 255, 0) 100%
        );
        animation: progress-shine 2s infinite linear;
      }
      
      @keyframes progress-shine {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      /* Info Text */
      .info-text {
        position: absolute;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        color: var(--text-dark);
        max-width: 450px;
        font-size: 16px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 12px 20px;
        z-index: 15;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s;
        animation: info-bounce 0.5s;
      }
      
      @keyframes info-bounce {
        0% {
          transform: translateX(-50%) translateY(20px);
          opacity: 0;
        }
        100% {
          transform: translateX(-50%) translateY(0);
          opacity: 1;
        }
      }
      
      .info-text.update {
        animation: info-highlight 1s;
      }
      
      @keyframes info-highlight {
        0% {
          background: rgba(200, 230, 201, 0.95);
        }
        100% {
          background: rgba(255, 255, 255, 0.95);
        }
      }

      /* Result Modal */
      .result-modal {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
        padding: 40px;
        z-index: 1001;
        text-align: center;
        min-width: 340px;
        max-width: 90vw;
        display: none;
        animation: popin 0.7s;
      }
      
      .result-modal h2 {
        margin: 0 0 20px 0;
        color: var(--primary-dark);
        font-size: 1.8rem;
      }
      
      .result-modal p {
        margin-bottom: 25px;
        font-size: 1.1rem;
        line-height: 1.5;
        color: var(--text-dark);
      }
      
      .result-modal .achievement {
        background: #F1F8E9;
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        border: 2px dashed #AED581;
        position: relative;
        overflow: hidden;
      }
      
      .result-modal .achievement::before {
        content: "";
        position: absolute;
        top: -10px;
        right: -10px;
        width: 80px;
        height: 80px;
        background: #AED581;
        transform: rotate(45deg);
        z-index: -1;
      }
      
      .result-modal .achievement h3 {
        margin: 0 0 10px 0;
        color: #558B2F;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .result-modal .achievement p {
        margin: 0;
        font-size: 1rem;
      }
      
      .result-buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
        align-items: center;
        margin-top: 20px;
      }
      
      .result-buttons button {
        padding: 12px 30px;
        font-size: 1.1rem;
        border-radius: 15px;
        border: none;
        background: #F5F5F5;
        color: #616161;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        width: 100%;
        font-family: 'Nunito', sans-serif;
      }
      
      .result-buttons button:hover {
        background: #E0E0E0;
        transform: translateY(-2px);
      }
      
      .result-buttons a {
        padding: 12px 30px;
        font-size: 1.1rem;
        border-radius: 15px;
        border: none;
        background: linear-gradient(90deg, #43A047 0%, #66BB6A 100%);
        color: white;
        font-weight: 700;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        transition: all 0.2s;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        width: 100%;
      }
      
      .result-buttons a:hover {
        background: linear-gradient(90deg, #388E3C 0%, #43A047 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 18px rgba(76, 175, 80, 0.4);
      }
      
      .result-buttons a img {
        height: 28px;
        width: 28px;
      }

      /* Facts Popup */
      .fact-popup {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.98);
        border-radius: 15px;
        padding: 15px 20px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        max-width: 280px;
        z-index: 20;
        transform: translateY(-20px);
        opacity: 0;
        transition: transform 0.4s ease-out, opacity 0.4s ease-out;
        pointer-events: none;
      }
      
      .fact-popup.show {
        transform: translateY(0);
        opacity: 1;
        animation: fact-glow 2s infinite alternate;
      }
      
      @keyframes fact-glow {
        0% {
          box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        }
        100% {
          box-shadow: 0 5px 25px rgba(76, 175, 80, 0.4);
        }
      }
      
      .fact-popup h3 {
        margin: 0 0 10px 0;
        color: var(--primary-dark);
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .fact-popup h3 span {
        font-size: 22px;
      }
      
      .fact-popup p {
        margin: 0;
        font-size: 15px;
        line-height: 1.5;
        color: var(--text-dark);
      }

      /* Bug styling */
      .bug {
        position: absolute;
        width: 60px;
        height: 60px;
        background-image: url('../assets/Sprite/insect1.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        cursor: pointer;
        z-index: 15;
        transition: transform 0.1s;
        filter: drop-shadow(0 3px 5px rgba(0, 0, 0, 0.2));
      }
      
      .bug:hover {
        transform: scale(1.1);
      }
      
      .bug-warning {
        position: absolute;
        top: -30px;
        left: 50%;
        transform: translateX(-50%);
        background: #FFEBEE;
        color: #D32F2F;
        padding: 5px 10px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: bold;
        white-space: nowrap;
        animation: warning-pulse 1s infinite alternate;
        box-shadow: 0 3px 8px rgba(211, 47, 47, 0.2);
        display: flex;
        align-items: center;
        gap: 5px;
      }
      
      @keyframes warning-pulse {
        0% {
          transform: translateX(-50%) scale(1);
        }
        100% {
          transform: translateX(-50%) scale(1.05);
        }
      }

      /* Plant Hint */
      .plant-hint {
        position: absolute;
        left: 43%;
        bottom: 220px;
        transform: translateX(-50%);
        z-index: 20;
        pointer-events: none;
        animation: hint-pop 1.2s infinite alternate;
      }
      
      @keyframes hint-pop {
        0% {
          transform: translateX(-50%) translateY(0);
        }
        100% {
          transform: translateX(-50%) translateY(10px);
        }
      }
      
      .hint-box {
        background: rgba(255, 255, 255, 0.98);
        border: 2px dashed var(--primary-color);
        border-radius: 15px;
        padding: 12px 20px;
        text-align: center;
        font-size: 1.15rem;
        color: var(--primary-dark);
        font-weight: 600;
        box-shadow: 0 5px 15px rgba(76, 175, 80, 0.15);
        position: relative;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      
      .hint-box span {
        font-size: 1.5rem;
      }
      
      .arrow-down {
        width: 0;
        height: 0;
        border-left: 20px solid transparent;
        border-right: 20px solid transparent;
        border-top: 20px solid var(--primary-color);
        margin: 0 auto;
        position: absolute;
        left: 50%;
        bottom: -20px;
        transform: translateX(-50%);
      }

      /* Water need indicator */
      .water-need-indicator {
        position: absolute;
        top: -40px;
        left: 50%;
        transform: translateX(-50%);
        background: #E3F2FD;
        border-radius: 10px;
        padding: 8px 12px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: bold;
        font-size: 14px;
        color: #0288D1;
        box-shadow: 0 3px 10px rgba(2, 136, 209, 0.2);
        opacity: 0;
        transition: opacity 0.3s;
        animation: water-indicator-pulse 1.5s infinite alternate;
        z-index: 12;
      }
      
      .water-need-indicator.show {
        opacity: 1;
      }
      
      @keyframes water-indicator-pulse {
        0% {
          transform: translateX(-50%) scale(1);
          box-shadow: 0 3px 10px rgba(2, 136, 209, 0.2);
        }
        100% {
          transform: translateX(-50%) scale(1.05);
          box-shadow: 0 3px 15px rgba(2, 136, 209, 0.4);
        }
      }

      /* Day/Night Indicator */
      .day-night-indicator {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255, 255, 255, 0.9);
        border-radius: 20px;
        padding: 8px 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: bold;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        z-index: 11;
        transition: all 0.5s ease;
      }
      
      .day-night-indicator.day {
        color: #FF9800;
      }
      
      .day-night-indicator.night {
        color: #3F51B5;
      }
      
      /* Stage transition animation */
      .stage-transition {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(76, 175, 80, 0.15);
        z-index: 999;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s;
      }
      
      .stage-transition.show {
        opacity: 1;
        animation: stage-transition-flash 0.8s;
      }
      
      @keyframes stage-transition-flash {
        0% {
          opacity: 0;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 0;
        }
      }
      
      .stage-message {
        background: white;
        border-radius: 20px;
        padding: 20px 30px;
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary-dark);
        box-shadow: 0 5px 30px rgba(0, 0, 0, 0.2);
        transform: scale(0.8);
        opacity: 0;
        transition: all 0.3s;
      }
      
      .stage-transition.show .stage-message {
        transform: scale(1);
        opacity: 1;
        animation: stage-message-pop 0.5s;
      }
      
      @keyframes stage-message-pop {
        0% {
          transform: scale(0.8);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* Utility Classes */
      .hidden {
        display: none !important;
      }
      
      .invisible {
        opacity: 0 !important;
        pointer-events: none !important;
      }
      
      .visible {
        opacity: 1 !important;
      }
      
      .highlight {
        animation: highlight-pulse 1s infinite alternate;
      }
      
      @keyframes highlight-pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.4);
        }
        100% {
          box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
        }
      }

      /* Spray Animation */
      .spray-particles {
        position: absolute;
        width: 100px;
        height: 100px;
        pointer-events: none;
        z-index: 25;
      }
      
      .spray-particle {
        position: absolute;
        width: 10px;
        height: 10px;
        background: rgba(100, 200, 100, 0.6);
        border-radius: 50%;
        animation: spray-particle 0.8s linear forwards;
      }
      
      @keyframes spray-particle {
        0% {
          transform: translate(0, 0) scale(0.5);
          opacity: 0.7;
        }
        100% {
          transform: translate(var(--x), var(--y)) scale(0);
          opacity: 0;
        }
      }

      /* Bug Splat Animation */
      .bug-splat {
        position: absolute;
        width: 60px;
        height: 60px;
        background: rgba(245, 245, 245, 0.8);
        border-radius: 50%;
        z-index: 14;
        transform: scale(0.8);
        opacity: 0.7;
        animation: bug-splat 0.6s linear forwards;
      }
      
      @keyframes bug-splat {
        0% {
          transform: scale(0.8);
          opacity: 0.7;
        }
        50% {
          transform: scale(1.2);
          opacity: 0.5;
        }
        100% {
          transform: scale(1.5);
          opacity: 0;
        }
      }

      /* Confetti Animation for Success */
      .confetti-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1000;
      }
      
      .confetti {
        position: absolute;
        width: 10px;
        height: 20px;
        animation: confetti-fall linear forwards;
      }
      
      @keyframes confetti-fall {
        0% {
          transform: translateY(-10px) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(360deg);
          opacity: 0;
        }
      }

      /* Responsive Styles */
      @media (max-width: 768px) {
        .welcome-modal h1 {
          font-size: 1.8rem;
        }
        
        .welcome-modal p {
          font-size: 1.1rem;
        }
        
        .welcome-modal button {
          padding: 10px 28px;
          font-size: 1rem;
        }
        
        .howto-modal h2 {
          font-size: 1.3rem;
        }
        
        .step-text {
          font-size: 1rem;
        }
        
        .scoreboard {
          padding: 12px 15px;
        }
        
        .scoreboard h1 {
          font-size: 16px;
        }
        
        .game-stat {
          font-size: 14px;
        }
        
        .ground {
          width: 250px;
          height: 60px;
          bottom: 100px;
        }
        
        .soil-surface {
          height: 30px;
        }
        
        .tool {
          width: 60px;
          height: 60px;
        }
        
        .progress-container {
          bottom: 40%;
        }
        
        .progress-bar-bg {
          width: 200px;
          height: 15px;
        }
        
        .info-text {
          font-size: 14px;
          max-width: 300px;
          padding: 10px 15px;
        }
        
        .fact-popup {
          max-width: 220px;
          right: 15px;
        }
        
        .fact-popup h3 {
          font-size: 16px;
        }
        
        .fact-popup p {
          font-size: 14px;
        }
        
        .result-modal {
          padding: 30px 25px;
        }
        
        .result-modal h2 {
          font-size: 1.5rem;
        }
        
        .result-modal p {
          font-size: 1rem;
        }
        
        .result-buttons a, 
        .result-buttons button {
          font-size: 1rem;
          padding: 10px 20px;
        }
      }
      
      @media (max-width: 480px) {
        .welcome-modal h1 {
          font-size: 1.6rem;
        }
        
        .welcome-modal p {
          font-size: 1rem;
        }
        
        .welcome-modal {
          padding: 30px 20px 20px 20px;
        }
        
        .howto-modal {
          padding: 20px 18px 18px 18px;
        }
        
        .ground {
          width: 200px;
          height: 50px;
        }
        
        .tool {
          width: 50px;
          height: 50px;
        }
        
        .progress-bar-bg {
          width: 180px;
        }
        
        .day-night-indicator {
          padding: 6px 15px;
          font-size: 14px;
        }
        
        .hint-box {
          font-size: 1rem;
          padding: 10px 15px;
        }
        
        .result-modal {
          padding: 25px 20px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Background Elements -->
    <div class="sky-objects">
      <div class="sun" id="sun"></div>
      <div class="moon" id="moon"></div>
      <div class="stars" id="stars"></div>
      <div class="cloud cloud-1"></div>
      <div class="cloud cloud-2"></div>
      <div class="cloud cloud-3"></div>
    </div>

    <!-- Game Overlay -->
    <div class="game-overlay" id="game-overlay"></div>

    <!-- Welcome Modal -->
    <div class="welcome-modal" id="welcome-modal">
      <span class="emoji">🌱🌳</span>
      <h1>Selamat Datang di Misi Pohon!</h1>
      <p>
        Di <b>Game Sahabat Alam</b>, kamu akan <b>menanam pohon</b>,
        <b>menyiram pohon</b>, dan
        <b>melindungi pohon dari hama</b>.<br /><br />
        Yuk mulai petualanganmu menjadi pahlawan lingkungan!
      </p>
      <div class="modal-buttons">
        <button id="show-howto-btn">
          Lihat Cara Main 📝
        </button>
        <button id="start-btn">Mulai Petualangan 🚀</button>
      </div>
    </div>

    <!-- Tutorial Modal -->
    <div class="howto-modal" id="howto-modal">
      <h2><span>🌱</span> Cara Bermain</h2>
      <div class="steps-container">
        <div class="howto-step">
          <div class="step-number">1</div>
          <div class="step-text">Klik pada tanah untuk menanam bibit pohon.</div>
        </div>
        <div class="howto-step">
          <div class="step-number">2</div>
          <div class="step-text">Gunakan alat penyiram jika pohon kering dan butuh air.</div>
        </div>
        <div class="howto-step">
          <div class="step-number">3</div>
          <div class="step-text">Gunakan alat pengusir hama jika ada serangga yang mendekat.</div>
        </div>
        <div class="howto-step">
          <div class="step-number">4</div>
          <div class="step-text">Rawat pohon agar tumbuh melalui semua 4 tahapan.</div>
        </div>
      </div>
      <div class="howto-tips">
        <b>Tips:</b> Perhatikan warna tanah! Jika tanah berwarna terang, segera siram agar pohon tidak kering. Pohon tumbuh lebih cepat di siang hari dengan sinar matahari.
      </div>
      <button id="close-howto-btn">Tutup</button>
    </div>

    <!-- Game Area -->
    <div class="game-area">
      <!-- Day/Night Indicator -->
      <div class="day-night-indicator day" id="day-night-indicator">
        <span id="day-night-icon">☀️</span> 
        <span id="day-night-text">Siang Hari</span>
      </div>

      <!-- Scoreboard -->
      <div class="scoreboard">
        <h1>🌱 Tanam & Jaga Pohon</h1>
        <div class="game-stats">
          <div class="game-stat">
            <div class="stat-icon">📊</div>
            <div>Level: <span class="stat-value" id="level-text">1</span></div>
          </div>
          <div class="game-stat">
            <div class="stat-icon">📅</div>
            <div>Hari: <span class="stat-value" id="day-count">1</span></div>
          </div>
          <div class="game-stat">
            <div class="stat-icon">⏱️</div>
            <div>Waktu: <span class="stat-value" id="timer">0</span> detik</div>
          </div>
          <div class="game-stat">
            <div class="stat-icon">❤️</div>
            <div>Kesehatan: <span class="stat-value" id="health">100</span>%</div>
          </div>
          <div class="health-bar-container">
            <div class="health-bar" id="health-bar" style="width: 100%;"></div>
          </div>
        </div>
      </div>

      <!-- Garden Container -->
      <div class="garden-container">
        <div class="ground-base"></div>
        <div class="soil-surface"></div>
        <div class="soil-decoration" style="left: 30%;"></div>
        <div class="soil-decoration" style="left: 45%;"></div>
        <div class="soil-decoration" style="left: 60%;"></div>
        <div class="soil-decoration" style="left: 75%;"></div>
        <div class="ground" id="ground"></div>
        <div class="planting-hole" id="planting-hole"></div>
        <div class="water-need-indicator" id="water-need-indicator">
          💧 Pohon Butuh Air!
        </div>
        <div class="tree-container">
          <img
            src="../assets/Sprite/pohon1.png"
            class="tree-stage stage-0"
            id="tree-stage-0"
            draggable="false"
            alt="Bibit Pohon"
          />
          <img
            src="../assets/Sprite/pohon3.png"
            class="tree-stage stage-1"
            id="tree-stage-1"
            draggable="false"
            alt="Pohon Kecil"
          />
          <img
            src="../assets/Sprite/pohon6.png"
            class="tree-stage stage-2"
            id="tree-stage-2"
            draggable="false"
            alt="Pohon Sedang"
          />
          <img
            src="../assets/Sprite/pohon8.png"
            class="tree-stage stage-3"
            id="tree-stage-3"
            draggable="false"
            alt="Pohon Besar"
          />
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress-container" id="progress-container">
        <div class="progress-label">
          <span class="progress-icon">🌱</span>
          <span id="progress-label">Pertumbuhan Pohon</span>
        </div>
        <div class="progress-bar-bg">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
      </div>

      <!-- Tools -->
      <div class="tool-container" id="tools">
        <div class="tool" id="water-tool" title="Siram Pohon">
          <img src="../assets/Sprite/water.png" alt="Siram" id="water-icon" />
          <div class="tool-label">Siram Pohon</div>
        </div>
        <div class="tool" id="bug-spray-tool" title="Usir Hama">
          <img
            src="../assets/Sprite/spray.png"
            alt="Usir Hama"
            id="spray-icon"
          />
          <div class="tool-label">Usir Hama</div>
        </div>
      </div>

      <!-- Info Text -->
      <div class="info-text" id="info-text">
        Klik tanah untuk menanam pohon. Jaga agar pohon tetap sehat!
      </div>

      <!-- Fact Popup -->
      <div class="fact-popup" id="fact-popup">
        <h3><span>💡</span> Tahukah Kamu?</h3>
        <p id="fact-text">
          Satu pohon besar dapat menghasilkan oksigen untuk 4 orang setiap hari!
        </p>
      </div>

      <!-- Stage Transition -->
      <div class="stage-transition" id="stage-transition">
        <div class="stage-message" id="stage-message">
          Pohon tumbuh ke tahap baru!
        </div>
      </div>

      <!-- Result Modal -->
      <div class="result-modal" id="result-modal">
        <h2 id="result-title"></h2>
        <p id="result-msg"></p>
        <div class="achievement" id="achievement">
          <h3><span>🏆</span> Pencapaian Baru!</h3>
          <p>Kamu mendapatkan lencana "Perawat Pohon Handal"</p>
        </div>
        <div class="result-buttons">
          <a id="result-next" href="tunarunguquest2.html">
            <img src="../assets/Sprite/pohon8.png" alt="Next" /> Lanjut Misi Berikutnya
          </a>
          <button id="result-retry">Coba Lagi</button>
        </div>
      </div>

      <!-- Plant Hint -->
      <div class="plant-hint" id="plant-hint">
        <div class="hint-box">
          <span>👇</span> Tap di sini untuk menanam pohon
          <div class="arrow-down"></div>
        </div>
      </div>
    </div>

    <script>
      // DOM Elements
      const welcomeModal = document.getElementById("welcome-modal");
      const startBtn = document.getElementById("start-btn");
      const showHowtoBtn = document.getElementById("show-howto-btn");
      const howtoModal = document.getElementById("howto-modal");
      const closeHowtoBtn = document.getElementById("close-howto-btn");
      const gameOverlay = document.getElementById("game-overlay");
      const gameArea = document.querySelector(".game-area");
      const ground = document.getElementById("ground");
      const plantingHole = document.getElementById("planting-hole");
      const waterNeedIndicator = document.getElementById("water-need-indicator");
      const tools = document.getElementById("tools");
      const waterTool = document.getElementById("water-tool");
      const bugSprayTool = document.getElementById("bug-spray-tool");
      const progressContainer = document.getElementById("progress-container");
      const progressBar = document.getElementById("progress-bar");
      const progressLabel = document.getElementById("progress-label");
      const infoText = document.getElementById("info-text");
      const timerText = document.getElementById("timer");
      const dayCount = document.getElementById("day-count");
      const healthText = document.getElementById("health");
      const healthBar = document.getElementById("health-bar");
      const levelText = document.getElementById("level-text");
      const resultModal = document.getElementById("result-modal");
      const resultTitle = document.getElementById("result-title");
      const resultMsg = document.getElementById("result-msg");
      const resultNext = document.getElementById("result-next");
      const resultRetry = document.getElementById("result-retry");
      const factPopup = document.getElementById("fact-popup");
      const factText = document.getElementById("fact-text");
      const stageTransition = document.getElementById("stage-transition");
      const stageMessage = document.getElementById("stage-message");
      const sun = document.getElementById("sun");
      const moon = document.getElementById("moon");
      const stars = document.getElementById("stars");
      const dayNightIndicator = document.getElementById("day-night-indicator");
      const dayNightIcon = document.getElementById("day-night-icon");
      const dayNightText = document.getElementById("day-night-text");

      // Tree stages elements
      const treeStagesImg = [
        document.getElementById("tree-stage-0"),
        document.getElementById("tree-stage-1"),
        document.getElementById("tree-stage-2"),
        document.getElementById("tree-stage-3"),
      ];

      // Game State
      let gameStarted = false;
      let treePlanted = false;
      let treeGrown = false;
      let growTime = 60; // 1 minute total
      let timeElapsed = 0;
      let dayCounter = 1;
      let growStage = 0;
      let currentTool = null;
      let healthValue = 100;
      let wateringNeeded = false;
      let isWateringNeededIndicatorVisible = false;
      let bugPresent = false;
      let activeBugs = [];
      let factShown = false;
      let isNight = false;
      let dayNightCycle = 20; // 20 seconds per cycle
      let gameInterval = null;
      let starsGenerated = false;

      // Tree growth stages configuration
      const growStages = [
        { id: "tree-stage-0", duration: 10, name: "Bibit Kecil", icon: "🌱" },
        { id: "tree-stage-1", duration: 15, name: "Tunas Pohon", icon: "🌿" },
        { id: "tree-stage-2", duration: 15, name: "Pohon Kecil", icon: "🌲" },
        { id: "tree-stage-3", duration: 20, name: "Pohon Besar", icon: "🌳" },
      ];

      // Educational facts
      const treeFacts = [
        "Satu pohon besar dapat menghasilkan oksigen untuk 4 orang setiap hari!",
        "Pohon membantu menyerap air hujan dan mencegah banjir.",
        "Akar pohon membantu menjaga tanah agar tidak longsor.",
        "Pohon adalah rumah bagi banyak hewan seperti burung dan tupai.",
        "Pohon membantu udara menjadi lebih sejuk saat cuaca panas.",
        "Daun pohon menangkap debu dan polusi udara.",
        "Pohon dapat hidup selama ratusan tahun!",
        "Pohon membantu menjaga kesuburan tanah.",
        "Satu hektar pohon dapat menyerap 6 ton karbon dioksida setiap tahun.",
        "Pohon bakau melindungi pantai dari abrasi dan badai."
      ];

      // Bug information
      const bugTypes = [
        { 
          name: "Hama", 
          speed: 0.6, 
          damage: 5, 
          size: 50, 
          image: "../assets/Sprite/insect1.png" 
        },
        { 
          name: "Hama", 
          speed: 0.8, 
          damage: 8, 
          size: 45, 
          image: "../assets/Sprite/insect2.png" 
        }
      ];

      // Initial Game Setup
      gameArea.style.filter = "blur(3px)";
      gameArea.style.pointerEvents = "none";
      tools.style.display = "none";

      // Generate stars for night sky
      function generateStars() {
        if (starsGenerated) return;
        
        const starsContainer = document.getElementById("stars");
        const numberOfStars = 50;
        
        for (let i = 0; i < numberOfStars; i++) {
          const star = document.createElement("div");
          star.className = "star";
          star.style.left = `${Math.random() * 100}%`;
          star.style.top = `${Math.random() * 60}%`;
          star.style.width = `${2 + Math.random() * 3}px`;
          star.style.height = star.style.width;
          star.style.animationDelay = `${Math.random() * 1.5}s`;
          starsContainer.appendChild(star);
        }
        
        starsGenerated = true;
      }

      // Initialize Button Event Listeners
      showHowtoBtn.addEventListener("click", function () {
        howtoModal.style.display = "block";
      });

      closeHowtoBtn.addEventListener("click", function () {
        howtoModal.style.display = "none";
      });

      startBtn.addEventListener("click", function () {
        welcomeModal.style.display = "none";
        howtoModal.style.display = "none";
        gameOverlay.classList.add("hidden");
        gameArea.style.filter = "none";
        gameArea.style.pointerEvents = "auto";
        gameStarted = true;
        startDayNightCycle();
        generateStars();
        
        // Play initial welcome sound
        playSound("start");
      });

      // Ground Click (Plant Tree)
      ground.addEventListener("click", function () {
        if (treePlanted || !gameStarted) return;

        // Hide plant hint
        document.getElementById("plant-hint").style.display = "none";

        // Animate soil for digging
        ground.style.animation = "soil-dig 0.6s ease";
        playSound("dig");
        
        setTimeout(() => {
          ground.style.animation = "";
        }, 600);

        // Show planting hole
        plantingHole.classList.add("visible");

        // Wait a moment before showing the tree
        setTimeout(() => {
          treePlanted = true;
          ground.classList.add("clicked");
          updateInfoText("Pohon mulai tumbuh! Jaga agar selalu sehat.", true);
          progressContainer.style.display = "flex";
          tools.style.display = "flex";
          levelText.textContent = "1";
          growStage = 0;
          showTreeStage(0);
          startGrowth();
          showRandomFact();
          playSound("plant");
        }, 800);
      });

      // Tool Selection
      waterTool.addEventListener("click", function () {
        if (!treePlanted) return;

        currentTool = "water";
        waterTool.classList.add("active");
        bugSprayTool.classList.remove("active");
        updateInfoText("Alat siram dipilih. Klik pohon untuk menyiram.", true);
        playSound("select");
      });

      bugSprayTool.addEventListener("click", function () {
        if (!treePlanted) return;

        currentTool = "spray";
        bugSprayTool.classList.add("active");
        waterTool.classList.remove("active");
        updateInfoText("Alat pengusir hama dipilih. Klik hama untuk mengusirnya.", true);
        playSound("select");
      });

      // Tree Interaction
      for (let i = 0; i < treeStagesImg.length; i++) {
        treeStagesImg[i].addEventListener("click", function (e) {
          e.stopPropagation();
          if (currentTool === "water" && wateringNeeded) {
            waterTree();
          }
        });
      }

      // Update Info Text with animation
      function updateInfoText(text, animate = false) {
        infoText.textContent = text;
        if (animate) {
          infoText.classList.remove("update");
          void infoText.offsetWidth; // Trigger reflow
          infoText.classList.add("update");
        }
      }

      // Sound Effects Function
      function playSound(type) {
        // In a real implementation, you would have actual sound files
        // Here we're just logging what sound would play
        console.log(`Playing sound: ${type}`);
        // This is a placeholder for actual sound implementation
      }

      // Functions
      function startGrowth() {
        timeElapsed = 0;
        updateProgress();

        // Start the growth timer
        gameInterval = setInterval(() => {
          timeElapsed++;
          timerText.textContent = timeElapsed;

          // Update progress bar
          updateProgress();

          // Check for tree stage changes
          checkGrowthStage();

          // Randomly trigger watering need (except during night)
          if (!isNight && !wateringNeeded && treePlanted && !treeGrown && Math.random() < 0.03) {
            triggerWateringNeed();
          }

          // Randomly spawn bugs (more likely at night)
          const bugChance = isNight ? 0.04 : 0.015;
          if (activeBugs.length < 3 && treePlanted && !treeGrown && Math.random() < bugChance) {
            spawnBug();
          }

          // Reduce health if tree needs water
          if (wateringNeeded) {
            reduceHealth(0.5);
          }

          // Game over if health reaches 0
          if (healthValue <= 0) {
            clearInterval(gameInterval);
            gameOver(false);
          }

          // Win condition
          if (growStage >= growStages.length - 1 && timeElapsed >= growTime) {
            clearInterval(gameInterval);
            treeGrown = true;
            gameOver(true);
          }
        }, 1000);
      }

      function startDayNightCycle() {
        setInterval(() => {
          isNight = !isNight;
          dayCounter = isNight ? dayCounter : dayCounter + 1;
          dayCount.textContent = dayCounter;

          if (isNight) {
            // Night time
            document.body.style.background = "url('../assets/Background/tunarunguMalam.jpg') no-repeat center center fixed";
            document.body.style.backgroundSize = "cover";
            sun.style.opacity = "0";
            moon.style.opacity = "1";
            stars.style.opacity = "1";
            dayNightIndicator.className = "day-night-indicator night";
            dayNightIcon.textContent = "🌙";
            dayNightText.textContent = "Malam Hari";
            updateInfoText("Malam hari telah tiba. Pohon istirahat dan tumbuh lebih lambat.");
            
            // Make tree sleep animation
            const activeTree = treeStagesImg[growStage];
            if (activeTree.classList.contains("active")) {
              activeTree.classList.remove("growing");
            }
            
            showRandomFact();
            playSound("night");
          } else {
            // Day time
            document.body.style.background = "url('../assets/Background/TunarunguBG.jpg') no-repeat center center fixed";
            document.body.style.backgroundSize = "cover";
            sun.style.opacity = "1";
            moon.style.opacity = "0";
            stars.style.opacity = "0";
            dayNightIndicator.className = "day-night-indicator day";
            dayNightIcon.textContent = "☀️";
            dayNightText.textContent = "Siang Hari";
            updateInfoText("Siang hari telah tiba. Pohon tumbuh lebih cepat dengan bantuan matahari.");
            
            // Make tree growing animation
            const activeTree = treeStagesImg[growStage];
            if (activeTree.classList.contains("active")) {
              activeTree.classList.add("growing");
            }
            
            playSound("day");
          }
        }, dayNightCycle * 1000);
      }

      function showTreeStage(stageIdx) {
        // Show stage transition
        if (stageIdx > 0) {
          stageMessage.textContent = `Pohon tumbuh ke tahap ${growStages[stageIdx].name}! ${growStages[stageIdx].icon}`;
          stageTransition.classList.add("show");
          playSound("grow");
          
          setTimeout(() => {
            stageTransition.classList.remove("show");
          }, 1500);
        }
        
        treeStagesImg.forEach((img, idx) => {
          if (idx === stageIdx) {
            img.classList.add("active");
            if (!isNight) img.classList.add("growing");
          }
          else {
            img.classList.remove("active", "growing");
          }
        });

        // Hide planting hole after first stage
        if (stageIdx > 0) {
          plantingHole.classList.remove("visible");
          progressLabel.textContent = `${growStages[stageIdx].icon} ${growStages[stageIdx].name}`;
          showRandomFact();
          
          // Celebratory effect for new stage
          createConfetti();
        }
      }

      function checkGrowthStage() {
        const currentStageTime = growStages
          .slice(0, growStage + 1)
          .reduce((acc, stage) => acc + stage.duration, 0);
          
        if (timeElapsed >= currentStageTime && growStage < growStages.length - 1) {
          growStage++;
          showTreeStage(growStage);

          // Show achievement message
          updateInfoText(`Pohon tumbuh ke tahap ${growStages[growStage].name}! ${growStages[growStage].icon}`, true);

          // Reset watering state
          wateringNeeded = false;
          ground.classList.remove("dry");
          waterNeedIndicator.classList.remove("show");
          
          // Increase health slightly as a reward
          increaseHealth(10);
        }
      }

      function updateProgress() {
        const progressPercentage = Math.min((timeElapsed / growTime) * 100, 100);
        progressBar.style.width = `${progressPercentage}%`;
      }

      function triggerWateringNeed() {
        if (!treePlanted || treeGrown) return;

        wateringNeeded = true;
        isWateringNeededIndicatorVisible = true;
        ground.classList.add("dry");
        ground.classList.remove("watered");
        waterNeedIndicator.classList.add("show");
        updateInfoText("Pohon butuh air! Gunakan alat siram sekarang!", true);
        playSound("needWater");
        
        // Auto-select water tool as a hint
        currentTool = "water";
        waterTool.classList.add("active");
        bugSprayTool.classList.remove("active");
      }

      function waterTree() {
        if (!wateringNeeded) return;

        // Create water animation
        for (let i = 0; i < 8; i++) {
          const drop = document.createElement("div");
          drop.className = "water-drop";
          drop.style.left = `${Math.random() * 60 + 45}%`;
          drop.style.top = `${Math.random() * 10 + 30}%`;
          gameArea.appendChild(drop);

          // Create water splash effect
          setTimeout(() => {
            const splash = document.createElement("div");
            splash.className = "water-splash";
            splash.style.left = drop.style.left;
            splash.style.top = "85%";
            gameArea.appendChild(splash);
            
            // Remove splash after animation
            setTimeout(() => {
              splash.remove();
            }, 600);
          }, 800);

          // Remove water drop after animation
          setTimeout(() => {
            drop.remove();
          }, 1000);
        }

        // Reset watering state
        wateringNeeded = false;
        isWateringNeededIndicatorVisible = false;
        ground.classList.remove("dry");
        ground.classList.add("watered");
        waterNeedIndicator.classList.remove("show");

        // Increase health
        increaseHealth(15);

        updateInfoText("Bagus! Pohon sudah disiram dan sehat kembali.", true);
        playSound("water");

        // Remove watered class after a while
        setTimeout(() => {
          ground.classList.remove("watered");
        }, 3000);
      }

      function spawnBug() {
        if (!treePlanted || treeGrown) return;

        // Select bug type
        const bugType = bugTypes[Math.floor(Math.random() * bugTypes.length)];
        
        // Create bug element
        const bug = document.createElement("div");
        bug.className = "bug";
        bug.style.backgroundImage = `url('${bugType.image}')`;
        bug.style.width = `${bugType.size}px`;
        bug.style.height = `${bugType.size}px`;
        
        // Add warning label
        const warning = document.createElement("div");
        warning.className = "bug-warning";
        warning.innerHTML = `⚠️ ${bugType.name}`;
        bug.appendChild(warning);

        // Position around the tree based on tree stage
        const treeBase = document.getElementById(`tree-stage-${growStage}`);
        const treeRect = treeBase.getBoundingClientRect();

        // Random position around the tree
        const angle = Math.random() * Math.PI * 2;
        const distance = 150 + Math.random() * 100;
        const x = Math.cos(angle) * distance + window.innerWidth / 2;
        const y = Math.sin(angle) * distance + treeRect.top + treeRect.height / 2;

        bug.style.left = `${x}px`;
        bug.style.top = `${y}px`;

        gameArea.appendChild(bug);
        
        // Track this bug
        const bugData = {
          element: bug,
          type: bugType,
          intervalId: null
        };
        
        activeBugs.push(bugData);

        // Bug movement animation
        let targetX = window.innerWidth / 2;
        let targetY = treeRect.top + treeRect.height / 2;
        
        bugData.intervalId = setInterval(() => {
          const bugRect = bug.getBoundingClientRect();
          const dx = targetX - (bugRect.left + bugRect.width / 2);
          const dy = targetY - (bugRect.top + bugRect.height / 2);
          const dist = Math.sqrt(dx * dx + dy * dy);

          if (dist < 10) {
            // Bug reached tree, damage it
            reduceHealth(bugType.damage);
            clearInterval(bugData.intervalId);
            
            // Create bug splat animation
            const splat = document.createElement("div");
            splat.className = "bug-splat";
            splat.style.left = bug.style.left;
            splat.style.top = bug.style.top;
            gameArea.appendChild(splat);
            
            // Remove splat after animation
            setTimeout(() => {
              splat.remove();
            }, 600);
            
            if (bug.parentNode) bug.remove();
            activeBugs = activeBugs.filter(b => b !== bugData);
            
            updateInfoText(`${bugType.name} merusak pohon! Kesehatan pohon berkurang ${bugType.damage}%.`, true);
            playSound("damage");
          } else {
            // Move bug toward tree - with slight randomness for more natural movement
            const randomOffset = Math.random() * 0.4 - 0.2;
            bug.style.left = `${bugRect.left + (dx * (bugType.speed + randomOffset)) / dist}px`;
            bug.style.top = `${bugRect.top + (dy * (bugType.speed + randomOffset)) / dist}px`;
          }
        }, 50);

        // Bug click event (spray)
        bug.addEventListener("click", () => {
          if (currentTool === "spray") {
            clearInterval(bugData.intervalId);
            
            // Create spray effect
            createSprayEffect(bug);
            
            // Create bug splat animation
            const splat = document.createElement("div");
            splat.className = "bug-splat";
            splat.style.left = bug.style.left;
            splat.style.top = bug.style.top;
            gameArea.appendChild(splat);
            
            // Remove splat after animation
            setTimeout(() => {
              splat.remove();
            }, 600);
            
            bug.remove();
            activeBugs = activeBugs.filter(b => b !== bugData);
            
            updateInfoText(`Kamu berhasil mengusir ${bugType.name}!`, true);
            playSound("spray");
            
            // Slight health bonus for quick reaction
            increaseHealth(2);
          }
        });

        updateInfoText(`Awas! Ada ${bugType.name} mendekati pohon. Gunakan alat pengusir hama!`, true);
        playSound("bug");
        
        // Auto-select spray tool as a hint
        currentTool = "spray";
        bugSprayTool.classList.add("active");
        waterTool.classList.remove("active");
      }

      function createSprayEffect(targetElement) {
        const sprayParticles = document.createElement("div");
        sprayParticles.className = "spray-particles";
        
        // Position spray near the bug
        const rect = targetElement.getBoundingClientRect();
        sprayParticles.style.left = `${rect.left}px`;
        sprayParticles.style.top = `${rect.top}px`;
        
        gameArea.appendChild(sprayParticles);
        
        // Create particles
        for (let i = 0; i < 20; i++) {
          const particle = document.createElement("div");
          particle.className = "spray-particle";
          
          // Random position and direction
          const angle = Math.random() * Math.PI * 2;
          const distance = 30 + Math.random() * 40;
          const x = Math.cos(angle) * distance;
          const y = Math.sin(angle) * distance;
          
          particle.style.setProperty('--x', `${x}px`);
          particle.style.setProperty('--y', `${y}px`);
          
          sprayParticles.appendChild(particle);
        }
        
        // Remove spray effect after animation
        setTimeout(() => {
          sprayParticles.remove();
        }, 800);
      }

      function increaseHealth(amount) {
        healthValue = Math.min(healthValue + amount, 100);
        healthText.textContent = Math.floor(healthValue);
        updateHealthBar();
      }

      function reduceHealth(amount) {
        healthValue = Math.max(healthValue - amount, 0);
        healthText.textContent = Math.floor(healthValue);
        updateHealthBar();
      }

      function updateHealthBar() {
        healthBar.style.width = `${healthValue}%`;
        
        // Update health bar color based on health value
        if (healthValue < 30) {
          healthBar.className = "health-bar danger";
          healthText.style.color = "#F44336";
        } else if (healthValue < 60) {
          healthBar.className = "health-bar warning";
          healthText.style.color = "#FF9800";
        } else {
          healthBar.className = "health-bar";
          healthText.style.color = "#4CAF50";
        }
      }

      function showRandomFact() {
        if (factShown) return;

        factShown = true;
        const randomFact = treeFacts[Math.floor(Math.random() * treeFacts.length)];
        factText.textContent = randomFact;
        factPopup.classList.add("show");

        setTimeout(() => {
          factPopup.classList.remove("show");
          factShown = false;
        }, 7000);
      }

      function createConfetti() {
        const confettiContainer = document.createElement("div");
        confettiContainer.className = "confetti-container";
        document.body.appendChild(confettiContainer);
        
        const colors = ["#4CAF50", "#8BC34A", "#FFEB3B", "#FF9800", "#2196F3"];
        
        for (let i = 0; i < 50; i++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.left = `${Math.random() * 100}%`;
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.width = `${5 + Math.random() * 10}px`;
          confetti.style.height = `${5 + Math.random() * 10}px`;
          confetti.style.opacity = Math.random();
          confetti.style.animationDuration = `${1 + Math.random() * 3}s`;
          
          confettiContainer.appendChild(confetti);
        }
        
        setTimeout(() => {
          confettiContainer.remove();
        }, 3000);
      }

      function gameOver(isWin) {
        // Clear all active timers and bugs
        clearInterval(gameInterval);
        activeBugs.forEach(bug => {
          clearInterval(bug.intervalId);
          if (bug.element.parentNode) bug.element.remove();
        });
        activeBugs = [];
        
        // Create confetti effect for win
        if (isWin) {
          createConfetti();
          resultTitle.textContent = "Pohonmu Sudah Tumbuh Besar! 🎉";
          resultMsg.textContent = `Selamat! Kamu berhasil menanam dan merawat pohon hingga tumbuh besar dalam ${dayCounter} hari dengan kesehatan ${Math.floor(healthValue)}%.`;
          resultNext.style.display = "flex";
          document.getElementById("achievement").style.display = "block";
          playSound("win");
        } else {
          resultTitle.textContent = "Pohonmu Tidak Sehat 😢";
          resultMsg.textContent = "Sayang sekali pohonmu tidak bisa tumbuh dengan baik. Mungkin perlu lebih sering disiram atau dilindungi dari hama.";
          resultNext.style.display = "none";
          document.getElementById("achievement").style.display = "none";
          playSound("lose");
        }

        resultRetry.style.display = "inline-block";
        resultModal.style.display = "block";
      }

      // Reset the game
      resultRetry.addEventListener("click", function() {
        location.reload();
      });

      // Fix for water need indicator positioning
      window.addEventListener("resize", function() {
        if (isWateringNeededIndicatorVisible) {
          // Reposition water need indicator with tree
          const treeBase = document.getElementById(`tree-stage-${growStage}`);
          if (treeBase) {
            const treeRect = treeBase.getBoundingClientRect();
            waterNeedIndicator.style.top = `${treeRect.top - 40}px`;
          }
        }
      });
    </script>
  </body>
</html>